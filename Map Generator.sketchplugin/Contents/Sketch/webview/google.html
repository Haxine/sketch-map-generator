<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps</title>
    <meta name='viewport' content='initial-scale=1.0'>
    <meta charset='utf-8'>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      }

      #map {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
      }

      h1 {
        color: #979797;
        text-align: center;
        line-height: 1.5;
        font-size: 18px;
        font-weight: 600;
        padding: 0 20px;
        margin: 0 auto;
      }
    </style>
    <script src='mapData.js'></script>
  </head>
  <body>
    <div id='map'></div>
    <script>
      var map;
      var mapElement = document.getElementById('map');
      var mapData = window.mapData;

      if (!mapData) {
        var titleElement = document.createElement('h1');

        titleElement.innerText = 'Nothing to show, please enter an address and click the preview button.';
        mapElement.appendChild(titleElement);
      }

      function initMap () {
        if (mapData) {
          var geocoder = new google.maps.Geocoder();
          var infoWindow = new google.maps.InfoWindow();

          geocoder.geocode({
            'address': mapData.address
          }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              var options = {
                center: results[0].geometry.location,
                zoom: parseInt(mapData.zoom),
                mapTypeId: mapData.type,
                streetViewControl: false,
                mapTypeControl: false,
                styles: JSON.parse(mapData.style)
              };

              map = new google.maps.Map(mapElement, options);

              var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location,
                draggable: true,
                title: 'Drag me!'
              });

              google.maps.event.addListener(marker, 'dragend', function (e) {
                geocodeLatLng(geocoder, map, infoWindow, marker);
              });
            }
          });
        }
      }

      function geocodeLatLng (geocoder, map, infowindow, marker) {
        var latlng = {
          lat: marker.getPosition().lat(),
          lng: marker.getPosition().lng()
        };

        geocoder.geocode({ 'location': latlng }, function (results, status) {
          if (status === 'OK') {
            if (results[0]) {
              var mapInfo = 'mapinfo$' + results[0].formatted_address + '$' + map.zoom;

              document.title = mapInfo;
              infowindow.setContent(mapInfo);
            } else {
              infowindow.setContent('No results');
            }
          } else {
            infowindow.setContent('Error');
          }

          infowindow.open(map, marker);
        });
      }
    </script>
    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBPSS1dILXvLs3Bp189PrCP7OMoD94RXmw&callback=initMap'
      async defer></script>
  </body>
</html>